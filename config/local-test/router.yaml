global:
  dequeue: true
  gc_interval: 5
  tx_idle_timeout: 5
  executor:
    max_inflight: 10
    watchdog_timeout: 10

rest_listener:
  # use_gunicorn: false
  use_hypercorn: true
  addr: ["127.0.0.1", 8000]
  cert: localhost.crt
  key: localhost.key
    
endpoint:
- name: outbound-gw
  msa: true
  output_handler:
    downstream_env_timeout: 5
    downstream_data_timeout: 5
  chain:
  - filter: exploder
    output_chain: msa-output
    msa: true
    max_attempts: 3
    rcpt_timeout: 4
    data_timeout: 4

- name: msa-output
  msa: true
  chain:
  - filter: message_builder
  - filter: router
    policy:
      name: dest_domain
# - filter: dkim
#   key
#   domain:
#   selector:
  - filter: rest_output
    static_endpoint: https://localhost:8001
    verify: localhost.crt
    http_host: outbound
#    remote_host_discovery: mx
    static_remote_host:
      host: 127.0.0.1
      port: 3025
    rcpt_timeout: 5
    data_timeout: 5

- name: inbound-gw
  msa: false
  output_handler:
    downstream_env_timeout: 5
    downstream_data_timeout: 5
  chain:
  - filter: exploder
    output_chain: mx-out
    max_attempts: 3
    rcpt_timeout: 4
    data_timeout: 4

- name: mx-out
  msa: false
  chain:
  - filter: router
    policy:
      name: local_domain
      domains:
      - name: d
  - filter: rest_output
    static_endpoint: https://localhost:8001
    verify: localhost.crt
    http_host: outbound
    static_remote_host:
      host: 127.0.0.1
      port: 3025
    rcpt_timeout: 5
    data_timeout: 5


storage:
  # engine: sqlite_memory
  # engine: sqlite
  #sqlite_db_filename: storage.sqlite3
  engine: postgres
  postgres_db_name: pykk
  unix_socket_dir: /var/run/postgresql
  #port: 5432

